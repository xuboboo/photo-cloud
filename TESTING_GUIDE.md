# ğŸ§ª åŠŸèƒ½æµ‹è¯•æŒ‡å—

## å½“å‰çŠ¶æ€

âœ… ç¯å¢ƒå˜é‡å·²é…ç½®  
âœ… ä»£ç é”™è¯¯å·²ä¿®å¤  
â³ ç­‰å¾… Supabase æ•°æ®åº“é…ç½®  

---

## ğŸ”§ åœ¨æµ‹è¯•å‰éœ€è¦å®Œæˆçš„é…ç½®

### å¿…é¡»å®Œæˆçš„æ­¥éª¤

#### 1. é…ç½®æ•°æ®åº“è¡¨ï¼ˆå¿…éœ€ï¼‰

åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œï¼š

**æ‰“å¼€ SQL Editor**ï¼š
1. è®¿é—® https://supabase.com/dashboard
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§ **SQL Editor**
4. ç‚¹å‡» **New Query**

**æ‰§è¡Œä»¥ä¸‹ SQL**ï¼š

```sql
-- åˆ›å»ºæ–‡ä»¶è¡¨
create table files (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references auth.users(id),
  path text not null,
  name text not null,
  type text not null,
  size int,
  created_at timestamp with time zone default now()
);

-- åˆ›å»ºç´¢å¼•
create index idx_files_user_id on files(user_id);
create index idx_files_created_at on files(created_at desc);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
alter table files enable row level security;

-- é…ç½®å®‰å…¨ç­–ç•¥
create policy "user_select_own_files" 
on files for select 
to authenticated 
using (auth.uid() = user_id);

create policy "user_insert_own_files" 
on files for insert 
to authenticated 
with check (auth.uid() = user_id);

create policy "user_delete_own_files"
on files for delete
to authenticated
using (auth.uid() = user_id);

create policy "user_update_own_files"
on files for update
to authenticated
using (auth.uid() = user_id)
with check (auth.uid() = user_id);
```

ç‚¹å‡» **Run** æ‰§è¡Œã€‚

#### 2. é…ç½® Storageï¼ˆå¿…éœ€ï¼‰

**åˆ›å»º Bucket**ï¼š
1. ç‚¹å‡»å·¦ä¾§ **Storage**
2. ç‚¹å‡» **Create a new bucket**
3. åç§°ï¼š`private-files`
4. **å–æ¶ˆå‹¾é€‰** "Public bucket"
5. ç‚¹å‡» **Create bucket**

**é…ç½®ç­–ç•¥**ï¼š
1. ç‚¹å‡» `private-files` bucket
2. ç‚¹å‡» **Policies** æ ‡ç­¾
3. ç‚¹å‡» **New Policy** â†’ **For full customization**

åˆ›å»º 3 ä¸ªç­–ç•¥ï¼š

**ç­–ç•¥ 1 - ä¸Šä¼ **ï¼š
```
Policy name: Users can upload own files
Allowed operation: INSERT
Target roles: authenticated
Policy definition:
(bucket_id = 'private-files'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text)
```

**ç­–ç•¥ 2 - æŸ¥çœ‹**ï¼š
```
Policy name: Users can view own files
Allowed operation: SELECT
Target roles: authenticated
Policy definition:
(bucket_id = 'private-files'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text)
```

**ç­–ç•¥ 3 - åˆ é™¤**ï¼š
```
Policy name: Users can delete own files
Allowed operation: DELETE
Target roles: authenticated
Policy definition:
(bucket_id = 'private-files'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text)
```

#### 3. é…ç½®è®¤è¯ï¼ˆå¯é€‰ä½†æ¨èï¼‰

**å…³é—­é‚®ç®±éªŒè¯**ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰ï¼š
1. ç‚¹å‡»å·¦ä¾§ **Authentication**
2. ç‚¹å‡» **Providers** æ ‡ç­¾
3. ç‚¹å‡» **Email** æä¾›å•†
4. **å–æ¶ˆå‹¾é€‰** "Confirm email"
5. ç‚¹å‡» **Save**

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1ï¼šæ³¨å†ŒåŠŸèƒ½

1. **åˆ·æ–°æµè§ˆå™¨**é¡µé¢ï¼ˆhttp://localhost:3000ï¼‰
2. åº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢ï¼Œæ— é”™è¯¯
3. ç‚¹å‡» **"è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿç«‹å³æ³¨å†Œ"**
4. è¾“å…¥æµ‹è¯•ä¿¡æ¯ï¼š
   - é‚®ç®±ï¼š`test@example.com`
   - å¯†ç ï¼š`test123456`
5. ç‚¹å‡» **"æ³¨å†Œ"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ˜¾ç¤º "æ³¨å†ŒæˆåŠŸ" æç¤º
- âœ… è‡ªåŠ¨åˆ‡æ¢åˆ°ç™»å½•æ¨¡å¼
- âœ… è¡¨å•å·²æ¸…ç©º

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- ç¡®è®¤æ•°æ®åº“è¡¨å·²åˆ›å»º
- ç¡®è®¤é‚®ç®±éªŒè¯å·²å…³é—­

### æµ‹è¯• 2ï¼šç™»å½•åŠŸèƒ½

1. ä½¿ç”¨åˆšæ‰æ³¨å†Œçš„è´¦æˆ·ç™»å½•
   - é‚®ç®±ï¼š`test@example.com`
   - å¯†ç ï¼š`test123456`
2. ç‚¹å‡» **"ç™»å½•"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… æˆåŠŸè·³è½¬åˆ°ä¸»é¡µ
- âœ… æ˜¾ç¤º "æˆ‘çš„æ–‡ä»¶" æ ‡é¢˜
- âœ… å³ä¸Šè§’æ˜¾ç¤º "ä¸Šä¼ æ–‡ä»¶" å’Œ "é€€å‡ºç™»å½•" æŒ‰é’®
- âœ… æ˜¾ç¤ºç©ºçŠ¶æ€ï¼ˆğŸ“‚ æš‚æ— æ–‡ä»¶ï¼‰

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- å°è¯•é‡æ–°æ³¨å†Œ

### æµ‹è¯• 3ï¼šä¸Šä¼ å›¾ç‰‡

1. ç‚¹å‡» **"ä¸Šä¼ æ–‡ä»¶"** æŒ‰é’®
2. é€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼ˆjpgã€pngã€gif ç­‰ï¼‰
3. åº”è¯¥çœ‹åˆ°æ–‡ä»¶é¢„è§ˆ
4. ç‚¹å‡» **"ä¸Šä¼ æ–‡ä»¶"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ˜¾ç¤º "ä¸Šä¼ æˆåŠŸ" æç¤º
- âœ… è‡ªåŠ¨è¿”å›ä¸»é¡µ
- âœ… æ–‡ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡
- âœ… æ˜¾ç¤ºæ–‡ä»¶åã€å¤§å°ã€æ—¶é—´
- âœ… æ˜¾ç¤º ğŸ–¼ï¸ å›¾æ ‡

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥ Storage bucket æ˜¯å¦åˆ›å»º
- æ£€æŸ¥ Storage ç­–ç•¥æ˜¯å¦é…ç½®
- æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆä¸è¶…è¿‡ 50MBï¼‰
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### æµ‹è¯• 4ï¼šä¸Šä¼  Markdown

1. åˆ›å»ºä¸€ä¸ªæµ‹è¯• `.md` æ–‡ä»¶ï¼š

**test.md å†…å®¹**ï¼š
```markdown
# æµ‹è¯•æ ‡é¢˜

è¿™æ˜¯ä¸€ä¸ªæµ‹è¯• Markdown æ–‡ä»¶ã€‚

## åŠŸèƒ½åˆ—è¡¨

- åŠŸèƒ½ 1
- åŠŸèƒ½ 2
- åŠŸèƒ½ 3

**ç²—ä½“æ–‡æœ¬** å’Œ *æ–œä½“æ–‡æœ¬*

```

2. ç‚¹å‡» **"ä¸Šä¼ æ–‡ä»¶"**
3. é€‰æ‹© `test.md` æ–‡ä»¶
4. ç‚¹å‡» **"ä¸Šä¼ æ–‡ä»¶"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä¸Šä¼ æˆåŠŸ
- âœ… æ–‡ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤º ğŸ“ å›¾æ ‡
- âœ… æ–‡ä»¶åæ˜¾ç¤ºä¸º `test.md`

### æµ‹è¯• 5ï¼šé¢„è§ˆ Markdown

1. åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšä¸Šä¼ çš„ `.md` æ–‡ä»¶
2. ç‚¹å‡» **ğŸ‘ï¸** é¢„è§ˆæŒ‰é’®

**é¢„æœŸç»“æœ**ï¼š
- âœ… è·³è½¬åˆ°é¢„è§ˆé¡µé¢
- âœ… Markdown æ­£ç¡®æ¸²æŸ“
- âœ… æ ‡é¢˜ã€åˆ—è¡¨ã€ç²—ä½“ç­‰æ ¼å¼æ­£ç¡®
- âœ… æ ·å¼ç¾è§‚
- âœ… æœ‰ "è¿”å›" æŒ‰é’®

### æµ‹è¯• 6ï¼šä¸‹è½½æ–‡ä»¶

1. åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ç‚¹å‡» **â¬‡ï¸** ä¸‹è½½æŒ‰é’®

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–°æ ‡ç­¾é¡µæ‰“å¼€
- âœ… æ–‡ä»¶æ­£ç¡®æ˜¾ç¤ºæˆ–ä¸‹è½½
- âœ… æ–‡ä»¶å†…å®¹å®Œæ•´

### æµ‹è¯• 7ï¼šåˆ é™¤æ–‡ä»¶

1. åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ç‚¹å‡» **ğŸ—‘ï¸** åˆ é™¤æŒ‰é’®
2. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡» **"ç¡®å®š"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–‡ä»¶ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
- âœ… åˆ·æ–°é¡µé¢åæ–‡ä»¶ä»ç„¶ä¸å­˜åœ¨

### æµ‹è¯• 8ï¼šæ‹–æ‹½ä¸Šä¼ 

1. ç‚¹å‡» **"ä¸Šä¼ æ–‡ä»¶"**
2. æ‹–æ‹½ä¸€ä¸ªæ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ
3. é‡Šæ”¾æ–‡ä»¶

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä¸Šä¼ åŒºåŸŸé«˜äº®æ˜¾ç¤º
- âœ… æ–‡ä»¶è¢«é€‰ä¸­
- âœ… æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
- âœ… å¯ä»¥æ­£å¸¸ä¸Šä¼ 

### æµ‹è¯• 9ï¼šç™»å‡ºåŠŸèƒ½

1. ç‚¹å‡»å³ä¸Šè§’ **"é€€å‡ºç™»å½•"** æŒ‰é’®
2. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡» **"ç¡®å®š"**

**é¢„æœŸç»“æœ**ï¼š
- âœ… è·³è½¬åˆ°ç™»å½•é¡µ
- âœ… æ— æ³•è®¿é—®ä¸»é¡µï¼ˆè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼‰

---

## ğŸ› å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1ï¼šæ³¨å†Œæ—¶æç¤º "Cannot read properties of undefined"

**åŸå› **ï¼šä»£ç å·²ä¿®å¤ï¼Œåˆ·æ–°é¡µé¢å³å¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åˆ·æ–°æµè§ˆå™¨é¡µé¢
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. é‡æ–°æ³¨å†Œ

### é”™è¯¯ 2ï¼šä¸Šä¼ å¤±è´¥ "new row violates row-level security policy"

**åŸå› **ï¼šRLS ç­–ç•¥æœªé…ç½®æˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨ Supabase SQL Editor ä¸­é‡æ–°æ‰§è¡Œ RLS ç­–ç•¥ SQL
2. ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
3. æ£€æŸ¥ Table Editor â†’ files â†’ Policies

### é”™è¯¯ 3ï¼šä¸Šä¼ å¤±è´¥ "storage/object-not-found"

**åŸå› **ï¼šStorage bucket æœªåˆ›å»ºæˆ–ç­–ç•¥æœªé…ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Storage ä¸­æ˜¯å¦æœ‰ `private-files` bucket
2. æ£€æŸ¥ bucket çš„ Policies æ˜¯å¦æœ‰ 3 ä¸ªç­–ç•¥
3. é‡æ–°åˆ›å»º Storage ç­–ç•¥

### é”™è¯¯ 4ï¼šæ— æ³•é¢„è§ˆ Markdown

**åŸå› **ï¼šæ–‡ä»¶è·¯å¾„æˆ–ç­¾å URL é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. ç¡®è®¤æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ 
3. æ£€æŸ¥ Storage ç­–ç•¥ä¸­çš„ SELECT æƒé™

### é”™è¯¯ 5ï¼šç™»å½•åç«‹å³è·³è½¬å›ç™»å½•é¡µ

**åŸå› **ï¼šä¼šè¯æœªæ­£ç¡®ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ Cookie
2. æ£€æŸ¥ .env é…ç½®æ˜¯å¦æ­£ç¡®
3. é‡æ–°ç™»å½•

---

## âœ… å®Œæ•´æµ‹è¯•æ£€æŸ¥æ¸…å•

å®Œæˆæ‰€æœ‰æµ‹è¯•åç¡®è®¤ï¼š

- [ ] å¯ä»¥æ³¨å†Œæ–°è´¦æˆ·
- [ ] å¯ä»¥ç™»å½•
- [ ] å¯ä»¥ä¸Šä¼ å›¾ç‰‡
- [ ] å¯ä»¥ä¸Šä¼  Markdown
- [ ] å¯ä»¥æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
- [ ] å¯ä»¥é¢„è§ˆ Markdown
- [ ] å¯ä»¥ä¸‹è½½æ–‡ä»¶
- [ ] å¯ä»¥åˆ é™¤æ–‡ä»¶
- [ ] å¯ä»¥æ‹–æ‹½ä¸Šä¼ 
- [ ] å¯ä»¥ç™»å‡º
- [ ] è·¯ç”±å®ˆå«æ­£å¸¸å·¥ä½œ
- [ ] æ•°æ®éš”ç¦»æ­£å¸¸ï¼ˆä¸åŒç”¨æˆ·çœ‹ä¸åˆ°å¯¹æ–¹çš„æ–‡ä»¶ï¼‰

---

## ğŸ“Š åœ¨ Supabase ä¸­éªŒè¯

### éªŒè¯æ•°æ®åº“

1. æ‰“å¼€ **Table Editor**
2. ç‚¹å‡» **files** è¡¨
3. åº”è¯¥èƒ½çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶è®°å½•
4. æ¯æ¡è®°å½•åº”è¯¥æœ‰ï¼š
   - idï¼ˆUUIDï¼‰
   - user_idï¼ˆä½ çš„ç”¨æˆ· IDï¼‰
   - pathï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰
   - nameï¼ˆæ–‡ä»¶åï¼‰
   - typeï¼ˆimages æˆ– markdownï¼‰
   - sizeï¼ˆæ–‡ä»¶å¤§å°ï¼‰
   - created_atï¼ˆåˆ›å»ºæ—¶é—´ï¼‰

### éªŒè¯ Storage

1. æ‰“å¼€ **Storage**
2. ç‚¹å‡» **private-files** bucket
3. åº”è¯¥èƒ½çœ‹åˆ°æ–‡ä»¶å¤¹ç»“æ„ï¼š
   ```
   private-files/
   â”œâ”€â”€ images/
   â”‚   â””â”€â”€ [user-id]/
   â”‚       â””â”€â”€ [timestamp]-[filename]
   â””â”€â”€ markdown/
       â””â”€â”€ [user-id]/
           â””â”€â”€ [timestamp]-[filename]
   ```

### éªŒè¯è®¤è¯

1. æ‰“å¼€ **Authentication** â†’ **Users**
2. åº”è¯¥èƒ½çœ‹åˆ°æ³¨å†Œçš„ç”¨æˆ·
3. æ˜¾ç¤ºé‚®ç®±å’Œåˆ›å»ºæ—¶é—´

---

## ğŸ‰ æµ‹è¯•å®Œæˆ

å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œæ­å–œä½ ï¼ç³»ç»Ÿå·²ç»å®Œå…¨æ­£å¸¸å·¥ä½œäº†ï¼

ç°åœ¨ä½ å¯ä»¥ï¼š
- å¼€å§‹ä½¿ç”¨ç³»ç»Ÿ
- è‡ªå®šä¹‰åŠŸèƒ½
- éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- æŸ¥çœ‹ Supabase Dashboard æ—¥å¿—
- å‚è€ƒ SUPABASE_SETUP_GUIDE.md
- æäº¤ Issue
